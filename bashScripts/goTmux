
#!/usr/bin/env bash

PERSONAL="~/Documents/Proyectos"
EYEWEAR="~/eyewear"
KIDDOM="~/kiddom"
KIDDOM_API="~/go/src/github.com/kiddom/api"
PEER_COLLECTIVE="~/peercollective"

createWindow() {
    session=$1
    window=$2
    workingDirectory=$3
    command=$4
    shift
    shift
    hasWindow=$(tmux list-windows -t $session | grep "$window")
    if [ -z "$hasWindow" ]; then
        cmd="tmux neww -t $session: -n $window -d"
        if [ $# -gt 0 ]; then
            cmd="$cmd -c $workingDirectory"
        fi
        echo "Creating Window(\"$hasWindow\"): $cmd"
        eval $cmd
        if [ ! -z "$command" ]; then
          eval "tmux send-keys -t $session:$window \"$command\" C-m"
        fi
    fi
}

createSession() {
    session=$1
    window=$2
    workingDirectory=$3
    command=$4
    shift
    shift
    cmd="tmux new -s $session -d -n $window -c $workingDirectory > /dev/null 2>&1"

    echo "Creating Session: $cmd"
    eval $cmd
    if [ ! -z "$command" ]; then
      eval "tmux send-keys -t $session:$window $command C-m"
    fi
}

while [ "$#" -gt 0 ]; do
    curr=$1
    shift

    case "$curr" in
    "-kiddom")
        createSession kiddom nvim-api  $KIDDOM_API/master
        createWindow kiddom nvim-app  $KIDDOM/web/master
        createWindow kiddom run-docker $KIDDOM/docker/master/v2 "docker-compose up"
        createWindow kiddom run-app $KIDDOM/web/master "npm start"
        createWindow kiddom run-api $KIDDOM_API/master "ENVIRONMENT=local AUTH_URL=localhost:5001 STREAM_API_KEY=8ks455je2kpk STREAM_API_SECRET=eun8zusbssmrhfg23n55xjwjkyzrwuscc6jphtbhuysg25e4uvf57ufsyyxv9eku go run main.go"
        ;;
    "-eyewear")
        createSession eyewear nvim-api  $EYEWEAR/api/develop
        createWindow eyewear nvim-app  $EYEWEAR/app/develop
        createWindow eyewear run $EYEWEAR/docker "./scripts/start.bash.clark -s develop -f develop"
        ;;
    "-adapix")
        createSession adapix nvim $PERSONAL/adapix/frontend 
        createWindow adapix run-app $PERSONAL/adapix/frontend "yarn dev" 
        ;;
    "-personal")
        createSession personal console $PERSONAL 
        ;;
    *) echo "Unavailable command... $curr"
    esac
done
